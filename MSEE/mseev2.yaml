#
# Current rules
# 1. All requests are sync.
#
# responses:
# post:
#   201 - Created
#   400 - Bad Request. Malformed arguments for API call
#   401 - Unauthorized.  Invalid authentication credentials 
#   403 - Forbidden (capacity isssues)
#   404 - Object is not found
#   409 - Conflict
#   405 - Method not allowed. Some attribute can not be updated.
#   500 - Internal Server Error
#   503 - Service Unavailable
# get:
#   200 - OK
#   400 - Bad Request. Malformed arguments for API call
#   401 - Unauthorized.  Invalid authentication credentials
#   404 - Object is not found
#   500 - Internal Server Error
#   503 - Service Unavailable
# delete:
#   200 - OK
#   204 - No Content
#   400 - Bad Request. Malformed arguments for API call
#   401 - Unauthorized.  Invalid authentication credentials
#   404 - Object is not found
#   500 - Internal Server Error
#   503 - Service Unavailable
#
# dictionary:
#   vrf_name
#   vrf_id
#   vnid
#   ip_prefix
#   ip_addr
#
# Requests:
# 1. Remove all resources vrouter
# 2. remove route but keep nexthop nexthop
#
# MS EE REST API v1. Defines API for controlling data path in both MS EE and Baremetal scenario.
# Scenario #1: MS EE.
# The dataplane has 2 sets of ports:
# 1. "customer" ports
# 2. "provider" ports
# Every "customer" port is connected to a customer device. It supports QinQ encapsulation only.
# All other packet types would be dropped. QinQ tag represents a customer virtual network.
# Every "provider" port is connected to some Azure networking device. It receives and sends
# VXLAN traffic most of the time.
#
# Scenario #2: Baremetal
# The dataplane has 2 sets of ports:
# 1. "baremetal server" ports
# 2. "provider" ports
# Every "baremetal server" port is connected to one baremetal server. It supports IPv4 traffic
# only (IPv4 frames, ARP frames). A baremetal server and its ports makes one L3 domain, which
# could be connected to other L3 domains.
# Every "provider" port is the same as the "provider" port for MS EE scenario
#
# Our dataplane is designed as follow
# 1. We have virtual routers which represents a "virtual network" for a customer. Virtual
#    routers are defined by "vrf_id" which is unsigned integer value. The virtual routers
#    are used to bind a customer ports with "provider" ports together.
# 2. We have a virtual routing table which is unique and separated for every virtual router.
# 3. We have tunnels which represent "Azure" next hops for virtual routing tables.
# 4. We have port specific API to define parameters for client ports
#
# When you remove an entity which is referenced by other entity (for example you want to remove
# a virtual router instance, but you have references to it from the virtual routes) the target
# entity will be removed with all entities (recursively) which has references to the removing entity.
# FIXME: Probably we should return list of all entities which have been removed (currently impossible
# to implement because of swssconfig restrictions)

# Some details about '40X' error responses:
# - '400' http error returns when there're one or more malformed arguments (wrong type, format, size) in the request.
# - '404' http error returns when there're one or more references to non-existent values in the request.
# In case of bulk API (vroute API):
# - If a request has a malformed argument (arguments) or a reference (references) to non-existent values
#   in its path the API must return '400' or '404' respectively.
# - if a request has the same error in the attributes of the request, the API must:
#    - run the request with the valid attributes
#    - return '200' http status code
#    - put malformed attributes into the list of 'failed' attributes.
#

swagger: '2.0'
info:
  title: MSEEv2 API
  description: MSEEv2 VNET Control API
  version: 1.0.0
host: msee.com
schemes:
  - http
  - https
basePath: /v1
produces:
  - application/json
consumes:
  - application/json
paths:
#----------------------------------------------
# Server level API
#----------------------------------------------
  '/config':
    # Not used in BlueBird as of today, modifying implementation for Production is TBD
    get:
      summary: Get the snapshot of current server configuration
      description: Returns a Json blob containing all configuration currently set up for the server.
      tags:
        - Shared
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/ServerSnapshot'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
  '/state/heartbeat':
    get:
      summary: the heartbeat API for caller to check the status of the server
      description: Returns Ok when server is live. Also returns API version and config reset time info of the server.
      tags:
        - Shared
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - server_version
              - reset_GUID
              - reset_time
            properties:
              server_version:
                type: string
                description: version of the restful server.
              reset_GUID:
                type: string
                description: a GUID which will change after each time server restart from scratch.
              reset_time:
                type: string
                format: date-time
                description: time of server restartting from scratch, in a human readable format.
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# Virtual router object
#----------------------------------------------
  '/config/vrouter/{vrf_id}':
    post:
      summary: Create a new virtual router
      description: If a virtual router with specified vrf_id doesn't exist, new vrf_id with empty virtual table would be created. If a virtual router with specified vrf_id exists already, it will return error '409'. /config/tunnel/decap/vxlan is a prerequisite for this, if it is called without a vxlan local vtep created, there will be a failure with code '404'.
      tags:
        - Shared
      parameters:
        - name: vrf_id
          in: path
          required: true
          type: integer
          format: int32
          description: virtual router id. (32-bit unsigned integer value)
        - name: attr
          in: body
          required: true
          description: attributes for virtual router
          schema:
            $ref: '#/definitions/VnetEntry'
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Capacity insufficient
          schema:
            $ref: '#/definitions/Error'
        '404':
           description: VxLAN VTEP not found
           schema:
             $ref: '#/definitions/Error'
        '409':
          description: VRF/VNET already exists
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get information about an existing virtual router
      description: Returns attributes for requested vrf_id. If the vrf_id is not defined it returns '404' error.
      tags:
        - Shared
      parameters:
        - name: vrf_id
          in: path
          required: true
          type: integer
          format: int32
          description: virtual router id
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - vrf_id
              - attr
            properties:
              vrf_id:
                type: integer
                format: int32
                description: virtual router id
              attr:
                $ref: '#/definitions/VnetEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Virtual router is not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Remove a virtual router
      description: Remove a virtual router which is defined by vrf_id. If a virtual router with 'vrf_id' is not defined the API will return '404'.
      tags:
        - Shared
      parameters:
        - name: vrf_id
          in: path
          required: true
          type: integer
          format: int32
          description: virtual router id
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Virtual router is not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
  '/config/vrouter':
    # Not used in BlueBird as of today, implementation for Production is TBD
    get:
      summary: Get a list of existing virtual routers
      description: Return a list of defined virtual router objects. If there're no virtual routers defined it returns an empty list.
      tags:
        - Shared
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              type: object
              required:
                - vrf_id
                - attr
              properties:
                vrf_id:
                  type: integer
                  format: int32
                  description: virtual router id
                attr:
                  $ref: '#/definitions/VirtualRouterEntry'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# VLAN interface 
#----------------------------------------------
    '/config/interface/vlan/{vlan_id}'
    post:
      summary: Create a new vlan interface
      description: Create a new vlan interface with name Vlan{vlan_id} and vlanid set to vlan_id. If such a vlan interface already exists then this method returns the error '409'. If a vnet with specified vrf_id in attr does not exist this function will return error '404'.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
        - name: attr
          in: body
          required: true
          description: attributes for vlan interface
          schema:
            $ref: '#/definitions/VlanEntry'
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Capacity insufficient
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: VRF/VNET not found
          schema:
            $ref: '#/definitions/Error'
        '409':
          description: VLAN already exists
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get information about an existing vlan interface
      description: Returns attributes for requested vlan. If the vlan is not defined it returns '404' error.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - vlan_id
              - attr
            properties:
              vlan_id:
                type: integer
                format: int12
                description: vlan id
              attr:
                $ref: '#/definitions/VlanEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Remove a vlan interface
      description: Remove a vlan interface which is defined by vlan_id. If a vlan interface with 'vlan_id' is not defined the API will return '404'.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlanid
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# VLAN interface member 
#----------------------------------------------
    '/config/interface/vlan/{vlan_id}/member/{if_name}'
    post:
      summary: Add a physical port to a vlan interface
      description: Add a member to interface Vlan{vlan_id}. If such a member already exists on this Vlan interface then this method returns the error '409'.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
        - name: if_name
          in: path
          required: true
          type: string
          description: Physical port name
        - name: attr
          in: body
          required: false
          description: attribute for vlan member
          schema:
            $ref: '#/definitions/VlanMemberEntry'
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Capacity insufficient
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not defined
          schema:
            $ref: '#/definitions/Error'
        '409':
          description: VLAN member already exists on the interface
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get information about an existing vlan port member on an existing vlan interface
      description: Returns attributes for requested vlan member. If the vlan/vlan member is not defined/present it returns '404' error.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
        - name: if_name
          in: path
          required: true
          type: string
          description: Physical port name
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
               - vlan_id
               - if_name
               - attr
            properties:
               vlan_id:
                 type: integer
                 format: int32
                 description: 12 bit vlan_id
               if_name:
                 type: string
                 description: Physical port name
               attr:
                 $ref: '#/definitions/VlanMemberEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not defined/Vlan member is not found on this interface. 
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Remove a vlan member from a vlan interface
      description: Remove a vlan member from a vlan interface which is defined by vlan_id. If a vlan interface with 'vlan_id' is not defined OR a vlan member 'if_name' is not present on the interface the API will return '404'.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
        - name: if_name
          in: path
          required: true
          type: string
          description: Physical port name
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not defined/Vlan member is not found on this Vlan interface
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# VLAN interface neighbor 
#----------------------------------------------
    '/config/interface/vlan/{vlan_id}/neighbor/{ip_addr}'
    post:
      summary: Add the connected end host's IP address to the vlan interface for arp assist and neighbor discovery 
      description: Add the connected end host's IP address to the vlan interface for arp assist and neighbor discovery. If such a neighbor already exists on this Vlan interface then this method returns the error '409', if the Vlan interface doesn't exist this returns error '404'.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
        - name: ip_addr
          in: path
          required: true
          type: string
          description: Connected end device IP address 
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Capacity insufficient
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not found
          schema:
            $ref: '#/definitions/Error'
        '409':
          description: VLAN neighbor already exists on the interface
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get information about an existing vlan neighbor on an existing vlan interface
      description: Returns HTTP success/failure code for requested neighbor. If the vlan/vlan neighbor is not defined/present it returns '404' error.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
        - name: ip_addr
          in: path
          required: true
          type: string
          description: Connected end device IP address
      responses:
        '200':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not found/Vlan neighbor is not found on this interface. 
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Remove a vlan neighbor from a vlan interface
      description: Remove a vlan neighbor from a vlan interface which is defined by vlan_id. If a vlan interface with 'vlan_id' is not defined OR a vlan neighbor 'ip_addr' is not present on the interface the API will return '404'.
      tags:
        - Shared
      parameters:
        - name: vlan_id
          in: path
          required: true
          type: integer
          format: int32
          description: 12 bit vlan_id
        - name: ip_addr
          in: path
          required: true
          type: string
          description: Connected end device IP address
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Vlan interface is not found/Vlan neighbor is not found on this Vlan interface
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'

#----------------------------------------------
# vxlan tunnel encap object
#----------------------------------------------
  '/config/tunnel/encap/vxlan/{vnid}':
  # Implementation for encap is left in for now, but it will not be used by us in the new model 
    put:
       description: Return success for now 
       responses:
          '204':
            description: OK
       description: Return success for now
    get:
       responses:
          '204':
            description: OK
    delete:
       description: Return success for now
       responses:
          '204':
            description: OK

#----------------------------------------------
# route object
#----------------------------------------------
  '/config/vrouter/{vrf_id}/routes':
    patch:
      summary: Create/update IP routes for a virtual router
      description: This API call receives a list of route entries to be added/modified/deleted from the virtual routing table defined by 'vrf_id'. If an object with vrf_id doesn't exist this will return an error code '404'. The 'cmd' attribute will determine whether this is an add or delete request. For 'add' operations the API will try to insert every route entry individually. If a route entry already exists in the virtual routing table, the attributes of the rouing entry will be updated and the route entry will be returned as a member of the "updated" list. If a route entry doesn't exist in the routing table yet, it will be inserted there and returned as a member of "added" list. If something went wrong the route entry will be returned as member of "failed" list with "error" attribute set to an actual error for the route entry. Similarly for 'delete' operations the API will try to delete every route entry individually, if the delete succeeds it will be returned as a member of the "deleted" list, if the delete fails it will be returned as a member of the "failed" list.  
      tags:
        - Shared
      parameters:
        - name: vrf_id
          in: path
          type: integer
          format: int32
          required: true
          description: name of a virtual id
        - name: attr
          in: body
          required: true
          description: attributes for virtual router IP prefix
          schema:
            type: array
            items:
              $ref: '#/definitions/RouteEntry'
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - added
              - updated
              - deleted
              - failed
            properties:
              added:
                description: list of added routes
                type: array
                items:
                  $ref: '#/definitions/RouteEntry'
              updated:
                description: list of updated routes
                type: array
                items:
                  $ref: '#/definitions/RouteEntry'
               deleted:
                 description: list of deleted routes
                 type: array 
                items:
                  $ref: '#/definitions/RouteEntry'
              failed:
                description: list of failed routes
                type: array
                items:
                  $ref: '#/definitions/RouteEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Capacity insufficient
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: VRF/VNET not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Remove IP routes for a virtual router
      description: This API call will remove all route entries from a virtual router defined by 'vrf_id'. If 'vnid' query parameter is defined, this API call will remove only routes for which nexthop tunnel is 'vnid'. If the removing went successfully the route entry will be added to "deleted" list in the response, otherwise it would be added to "failed" list.
      tags:
        - Shared
      parameters:
        - name: vrf_id
          in: path
          type: integer
          format: int32
          required: true
          description: name of a virtual id
        - name: vnid
          in: query
          required: false
          type: integer
          format: int32
          description: vxlan id (24-bit). Allows to remove routes with defined vnid only. Applicable for routes with nexthop_type 'vxlan-tunnel'. Otherwise '400' error will be returned
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - deleted
              - failed
            properties:
              removed:
                description: list of removed routes
                type: array
                items:
                  $ref: '#/definitions/RouteEntry'
              failed:
                description: list of failed routes
                type: array
                items:
                  $ref: '#/definitions/RouteEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get IP routes for a given virtual router
      description: Return a list of routing entries for a given virtual router defined by "vrf_id" parameter. If there're no routing entries an empty list would be returned. The output list could be filterd by "vnid" and "ip_prefix" parameters. If one of the parameters is defined for the request, the output will contain only routing entries which have this parameter in their attributes.
      tags:
        - Shared
      parameters:
        - name: vrf_id
          in: path
          required: true
          type: integer
          format: int32
          description: virtual router id
        - name: vnid
          in: query
          required: false
          type: integer
          format: int32
          description: vxlan id (24-bit). Allows to output routes with defined vnid only. Applicable for routes with nexthop_type 'vxlan-tunnel'. Otherwise '400' error will be returned
        - name: ip_prefix
          in: query
          required: false
          type: string
          description: destination IP address block. If presented, get will return information about only this ip prefix
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/RouteEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# QinQ interface object: Removed
#----------------------------------------------
#----------------------------------------------
# Port interface object
#----------------------------------------------
  '/config/interface/port/{port}':
  # The code is left in but will not be used
    put:
      summary: Create/update port router interface.
      description: If the interface is already created, only attribute "spoof_guard" can be updated. If the "port" was already used for "/config/interface/qinq/{port}/{stag}/{ctag}' API, '400' error will be returned."
      tags:
        - Baremetal
      parameters:
        - name: port
          in: path
          required: true
          type: string
          description: router interface name
        - in: body
          name: attr
          required: true
          description: attributes for port router interface
          schema:
            $ref: '#/definitions/PortEntry'
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Capacity insufficient
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Remove port router interface
      description: If the "port" was already used for "/config/interface/qinq/{port}/{stag}/{ctag}' API, '400' error will be returned."
      tags:
        - Baremetal
      parameters:
        - in: path
          name: port
          type: string
          required: true
          description: physical port that bound to the port router interface
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get port router interface information
      description: If the "port" was already used for "/config/interface/qinq/{port}/{stag}/{ctag}' API, '400' error will be returned."
      tags:
        - Baremetal
      parameters:
        - name: port
          in: path
          required: true
          type: string
          description: physical port that bound to the port router interface
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - port
              - attr
            properties:
              port:
                type: string
                description: physical port that bound to the port router interface
              attr:
                $ref: '#/definitions/PortEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# PHY interface object
#----------------------------------------------
  '/state/interface/{port}':
    # BlueBird does not seem to use it today, implementation is left in
    get:
      summary: Get information about a device physical interface
      tags:
        - Shared
      parameters:
        - name: port
          in: path
          type: string
          required: true
          description: physical port
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - port
              - attr
            properties:
              port:
                type: string
                description: physical port
              attr:
                $ref: '#/definitions/InterfaceEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
  '/state/interface':
    # BlueBird does not seem to use it today, implementation is left in
    get:
      summary: Get information about all device physical interfaces
      tags:
        - Shared
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              type: object
              required:
                - port
                - attr
              properties:
                port:
                  type: string
                  description: physical port
                attr:
                  $ref: '#/definitions/InterfaceEntry'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# tunnel decapsulation endpoint object
#----------------------------------------------
  '/config/tunnel/decap/{tunnel_type}':
    post:
      summary: Setup or update tunnel decapsulation parameters
      tags:
        - Shared
      description: >-
          For vxlan tunnel, the router will use vnid to vrf_id mapping to determine subsequent virtual router to do L3 lookup after the decap.
      parameters:
        - name: tunnel_type
          in: path
          required: true
          type: string
          enum:
            - vxlan
          description: type of a tunnel endpoint
        - name: attr
          in: body
          required: true
          description: attributes for TunnelDecapsulator
          schema:
            $ref: '#/definitions/TunnelDecapEntry'
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Capacity insufficient
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '409':
          description: Object already exists
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get tunnel decapsulation parameters
      tags:
        - Shared
      parameters:
        - name: tunnel_type
          in: path
          required: true
          type: string
          enum:
            - vxlan
          description: type of a tunnel endpoint
      responses:
        '200':
          description: OK
          schema:
            type: object
            required:
              - tunnel_type
              - attr
            properties:
              tunnel_type:
                type: string
                enum:
                  - vxlan
              attr:
                $ref: '#/definitions/TunnelDecapEntry'
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Remove tunnel decapsulation information
      tags:
        - Shared
      parameters:
        - name: tunnel_type
          in: path
          type: string
          required: true
          enum:
            - vxlan
          description: type of a tunnel endpoint
      responses:
        '204':
          description: OK
        '400':
          description: Malformed arguments for API call
          schema:
            $ref: '#/definitions/Error'
        '401':
          description: Invalid authentication credentials
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Object not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Internal service error
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Maintanence mode
          schema:
            $ref: '#/definitions/Error'
#----------------------------------------------
# Monitor object
#----------------------------------------------
#----------------------------------------------
# Schema definitions
#----------------------------------------------
definitions:
  Error:
    type: object
    properties:
      error:
        type: object
        required:
          - code
          - message
        properties:
          code:
            type: integer
            format: int32
          message:
            type: string
          fields:
            type: array
            items:
              type: string
          details:
            type: string
  RouteEntry:
    type: object
    required:
      - ip_prefix
      - nexthop_type
      - nexthop
    properties:
      cmd:
        description: >-
          add/delete, this defines the operation to perform on the route for the PATCH function.
          note, this is REQUIRED for PATCH and will not be populated for GET/DELETE 
      ip_prefix:
        description: >-
          destination IP address block, either customer advertised
          on-premise IP prefix block or customer VM IP address. This
          is limited to v4 IP address.
        type: string
      nexthop_type:
        type: string
        enum:
          - ip
          - vxlan-tunnel
        description: next hop type. ip nexthop or vxlan tunnel nexthop. For future, we can more tunnel nexthop such as vxlan-gpe,nvgre, etc. on
      nexthop:
        type: string
        description: >-
          ip address of nexthop.
          When nexthop_type is 'ip', then nexthop is the CE IP address;
          When nexthop_type is 'vxlan_tunnel', the next hop is the PA address of the customer VM
      mac_address:
        type: string
        description: >-
          when ip_prefix has a length == 32, then this is a mac address of the target host defined by the "ip_prefix"
          when ip_prefix has a length  < 32, then this is a mac address of a gateway for the "ip_prefix" network
          this attrubute is required if nexthop_type=='vxlan-tunnel'.
      vnid:
        type: integer
        format: int32
        description: vxlan id for a tunnel. In case of vxlan tunnel it contains vxlan tunnel id (24-bit). Invalid for other next hop types. This parameter is required if nexthop_type=='vxlan-tunnel'
      src_ip:
        type: string
        description: >-
          tunnel source IP address. By default, it uses the
          corresponding loopback IP. If the nexthop is v4, then use the
          v4 loopback IP of the device. If the nexthop is v6, then use
          the v6 loopback IP of the device.
      port:
        type: string
        enum:
          - standard
          - azure
        description: >-
          port to use for VXLAN encapsulation standard = 4789 azure = 65330
          will default to azure
      error:
        type: string
        description: error which causes to the route to be upserted
  PortEntry:
    type: object
    required:
      - vrf_id
      - addr
      - mac_address
    properties:
      vrf_id:
        type: integer
        format: int32
        description: virtual router id
      addr:
        type: string
        description: interface address with ip prefix length. It's possible to have several ip addresses per vrouter
      spoof_guard:
        description: defines a list of ipv4 prefixes, which expected to be seen behind this interface. In case this attribute is missing, or the list is empty this feature is disabled.
        type: array
        items:
          type: string
      mac_address:
        type: string
        description: >-
          MAC address of the customer device.
  TunnelDecapEntry:
    type: object
    required:
      - ip_addr
    properties:
      ip_addr:
        type: string
        description: tunnel local termination IP address
  VirtualRouterEntry:
    type: object
    required:
      - vrf_name
    properties:
      vrf_name:
        type: string
        description: name of the Virtual Router
      dhcp_relays:
        description: list of ipv4 addresses of dhcp relays for this vnet
        type: array
        items:
          type: string
  VnetEntry:
    type: object
    required:
      - vnid
    properties:
      vrf_id:
        type: integer
        format: int32
        description: vnid
  InterfaceEntry:
    type: object
    required:
      - admin-state
    properties:
      admin-state:
        type: string
        enum:
          - up
          - down
        description: interface adminstrative state
  VlanEntry:
    type: object
    required:
      - vrf_id
      - ip_prefix
    properties:
      vrf_id:
        type: integer
        format: int32
        description: virtual router id
      ip_prefix:
        description: >-
          Vlan interface IP address and prefix, this will act as
          the default gateway to/from the HSM. 
        type: string
  VlanMemberEntry:
    type: object
    properties:
      tagging_mode:
        type: string
        description: tagged/untagged describes the vlan member's tagging mode, eg: HSM accepts only untagged traffic
  ServerSnapshot:
    type: object
    properties:
      decap_model:
        $ref: '#/definitions/TunnelDecapEntry'
      vrf_map:
        additionalProperties:
          $ref: '#/definitions/VrfSnapshot'
  VrfSnapshot:
    type: object
    properties:
      vrf_info:
        $ref: '#/definitions/VnetEntry'
      port_map:
        additionalProperties:
          $ref: '#/definitions/PortEntry'
      routes:
        additionalProperties:
          $ref: '#/definitions/RouteEntry'
